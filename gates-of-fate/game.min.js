!function(){"use strict";const e="1.0.0";let t={FADE_TIME:200,height:window.innerHeight,width:window.innerWidth,body:document.getElementsByTagName("body")[0],pages:{load:document.getElementById("load-page"),start:document.getElementById("start-page"),customize:document.getElementById("customize-page"),exploration:document.getElementById("exploration-page"),battle:document.getElementById("battle-page"),flee:document.getElementById("flee-page")},currentPage:"load",loadPageImg:document.getElementById("load-page-image"),avatarBtn:document.getElementById("avatar-img-button"),avatarImage:document.getElementById("avatar-img"),playCustomizeBtn:document.getElementById("play-button-customize"),textPassage:document.getElementById("text-passage"),textPassageContainer:document.getElementById("text-passage-container"),roomGraphic:document.getElementById("room-graphic"),loadingImage:document.getElementById("loading-image"),tileLayer1:null,tileLayer2:null,allTiles:null,imageModal:document.getElementById("image-modal"),closeModalBtn:document.getElementById("close-image-modal"),playBtn:document.getElementById("play-button"),backgroundImg:document.getElementById("background-img"),userInputName:document.getElementById("user-input-name"),input:document.getElementById("input-box-name"),musicBtn:document.getElementById("music-button"),battleBtn:document.getElementById("battle-button"),fleeBtn:document.getElementById("flee-button"),itemsBtn:document.getElementById("items-button"),rollDiceBtn:document.getElementById("dice-roller"),rollDiceFleeBtn:document.getElementById("dice-roller-flee"),diceImageList:document.querySelectorAll(".dice-img"),diceImageListFlee:document.querySelectorAll(".dice-img-flee"),mathQuestion:document.getElementById("math-question"),fleeDiceValue:document.getElementById("flee-dice-value"),fightWrapper:document.getElementById("fight-wrapper"),avatarImgBattle:document.getElementById("character-avatar"),avatarImgFlee:document.getElementById("character-avatar-flee"),infoBox:document.getElementById("battle-info-fight"),infoBoxFlee:document.getElementById("battle-info-flee"),submitBtn:document.getElementById("submit-answer"),userInput:document.getElementById("user-input"),mathResult:document.getElementById("math-result"),questionContainer:document.getElementById("dice-question-container"),questionContainerFlee:document.getElementById("dice-question-container-flee"),timeRemaining:document.getElementById("time-remaining"),progressBar:document.getElementById("progress-bar"),saveBtn:document.getElementById("save"),exitBtn:document.getElementById("exit"),monsterNames:["Smokechild","The Giant Mutant Horror","Mournling","Corpsetooth","The Corrupt Troglodyte","The Aromatic Demon","The Barren Creeper","Cometthought","The Electric Dread Swine","The Illusionary Devourer"],monsterNameLabel:document.getElementById("monster-name"),monsterLevelLabelFlee:document.getElementById("monster-level-flee"),monsterNameLabelFlee:document.getElementById("monster-name-flee"),monsterLevelLabel:document.getElementById("monster-level"),monsterWrapper:document.getElementById("monster-wrapper"),monsterHealthText:document.getElementById("monster-percent"),monsterBarElement:document.getElementById("monster-bar"),monsterPicture:document.getElementById("monster-pic"),monsterHealthTextFlee:document.getElementById("monster-percent-flee"),monsterBarElementFlee:document.getElementById("monster-bar-flee"),monsterPictureFlee:document.getElementById("monster-pic-flee"),monsterFloaty:document.getElementById("monster-health-floaty"),monsterWeapon:document.getElementById("monster-weapon"),characterWrapper:document.getElementById("character-wrapper"),characterHealthText:document.getElementById("character-percent"),characterBarElement:document.getElementById("character-bar"),characterHealthTextFlee:document.getElementById("character-percent-flee"),characterBarElementFlee:document.getElementById("character-bar-flee"),characterWeapon:document.getElementById("character-weapon"),characterFloaty:document.getElementById("character-health-floaty"),characterExpFloaty:document.getElementById("character-exp-floaty"),characterAvatar:document.getElementById("character-avatar"),characterLevelLabel:document.getElementById("character-level"),characterNameLabel:document.getElementById("character-name"),characterLevelLabelFlee:document.getElementById("character-level-flee"),characterNameLabelFlee:document.getElementById("character-name-flee"),characterExperienceText:document.getElementById("experience-percent"),characterExperienceBar:document.getElementById("experience-bar"),characterExperienceTextFlee:document.getElementById("experience-percent-flee"),characterExperienceBarFlee:document.getElementById("experience-bar-flee"),setBgFade:function(e){t.backgroundImg.style.filter=e?"blur(12px) brightness(70%)":""},goToPage:function(e){switch(this.pages[this.currentPage].style.display="none",e){case"start":this.setBgFade(!1),Y();break;case"battle":t.characterAvatar.style.top="0px",t.monsterPicture.style.top="0px",t.characterWrapper.style.visibility="visible",t.monsterWrapper.style.visibility="visible",s&&f.paused&&(p.pause(),f.currentTime=0,f.play());break;case"exploration":s&&p.paused&&(p.currentTime=0,p.play(),f.pause())}this.currentPage=e,this.pages[e].style.display="block"},resize:function(){this.height=window.innerHeight,this.width=window.innerWidth,this.body.style.height=this.height+"px",this.body.style.width=this.width+"px",this.textPassageContainer.style.height=.25*this.height+"px",this.roomGraphic.style.height=.6*this.height+"px",this.roomGraphic.style.width="100%",I()}},n=null,l={name:"Player 1",avatarImg:"assets/character1.png",level:1,health:25,totalHealth:25,diceValues:null,exp:0,totalExperience:50},a={name:"blank",level:0,health:0,totalHealth:0},o=0,i={totalTime:0,timeRemaining:-2,countDownIncrement:0,barWidth:0},r=0,s=!1,c=document.getElementById("button-sound"),d=document.getElementById("dice-sound"),m=document.getElementById("fire-sound"),u=document.getElementById("sword-sound"),h=document.getElementById("health-sound"),g=document.getElementById("door-sound"),y=document.getElementById("crumbling-sound"),p=document.getElementById("bgm"),f=document.getElementById("battle-bgm"),b=[d,m,u,g,y];for(let e=0;e<b.length;e++)b[e].volume=.1;f.loop=!0,f.volume=.03,p.loop=!0,p.volume=.03,p.load();let B={numRoomTypes:2,currentRoom:null,0:{name:"bedroom",auras:["humid","comfy","dusty","nostalgic"],objTypes:[15,17,19,20,21],guaranteedObjects:[18,16],maxDoors:2},1:{name:"storage room",auras:["chilly","lonely","dusty","smelly"],objTypes:[15,20,22,23],guaranteedObjects:[],maxDoors:1}},E={0:{array:[[5,5,1,1,1,1,1,1,1,1,1,1,1,6,6],[5,5,1,1,1,1,1,1,1,1,1,1,1,6,6],[2,2,0,0,0,0,0,0,0,0,0,0,0,3,3],[2,2,0,0,0,0,0,0,0,0,0,0,0,3,3],[2,2,0,0,0,0,0,0,0,0,0,0,0,3,3],[2,2,0,0,0,0,0,0,0,0,0,0,0,3,3],[2,2,0,0,0,0,0,0,0,0,0,0,0,3,3],[2,2,0,0,0,0,0,0,0,0,0,0,0,3,3],[7,7,4,4,4,4,4,4,4,4,4,4,4,8,8],[7,7,4,4,4,4,4,4,4,4,4,4,4,8,8]],height:10,width:15},1:{array:[[5,5,1,1,1,1,1,1,1,6,6],[5,5,1,1,1,1,1,1,1,6,6],[2,2,0,0,0,0,0,0,0,3,3],[2,2,0,0,0,0,0,0,0,3,3],[2,2,0,0,0,0,0,0,0,3,3],[2,2,0,0,0,0,0,0,0,3,3],[2,2,0,0,0,0,0,0,0,25,25,1,1,1,1,1,1,1,6,6],[2,2,0,0,0,0,0,0,0,25,25,1,1,1,1,1,1,1,6,6],[2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3],[2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3],[2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3],[2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3],[7,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,8],[7,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,8]],height:14,width:20},2:{array:[[5,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,6,6],[5,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,6,6],[2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3],[2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3],[2,2,0,0,0,0,0,0,27,27,28,28,0,0,0,0,0,0,3,3],[2,2,0,0,0,0,0,0,27,27,28,28,0,0,0,0,0,0,3,3],[2,2,0,0,0,0,0,0,3,3,2,2,0,0,0,0,0,0,3,3],[2,2,0,0,0,0,0,0,3,3,2,2,0,0,0,0,0,0,3,3],[2,2,0,0,0,0,0,0,3,3,2,2,0,0,0,0,0,0,3,3],[2,2,0,0,0,0,0,0,3,3,2,2,0,0,0,0,0,0,3,3],[7,7,4,4,4,4,4,4,8,8,7,7,4,4,4,4,4,4,8,8],[7,7,4,4,4,4,4,4,8,8,7,7,4,4,4,4,4,4,8,8]],height:12,width:20},numMaps:3,currentMap:null,objMap:null},v=function(){let e="assets/interiorTileset.png";return{tilesToLoad:84,backgroundTiles:8,transparent:M(e,64,64,1,12),15:{name:"bag",tiles:[[M(e,64,64,4,14)]],isTall:!1,message:"It looks dirty. You'd rather not touch it.",clickEvent:null},16:{name:"wardrobe",tiles:[[M(e,64,64,2,14),M(e,64,64,3,14)],[M(e,64,64,2,15),M(e,64,64,3,15)]],isTall:!0,message:"It seems to be sturdily built out of oak.",clickEvent:function(){let e="The wardrobe doors groan as you pull them apart. Inside, you find ";e+="nothing but dust and cobwebs.",t.textPassage.appendChild(T(" Open it?",function(){w("The wardrobe doors groan as you pull them apart. Inside, you find nothing but dust and cobwebs.")}))}},17:{name:"vase of flowers",tiles:[[M(e,64,64,11,14)]],isTall:!1,message:"You take a sniff. It smells like cheap plastic.",clickEvent:null},18:{name:"bed",tiles:[[M(e,64,64,14,13),M(e,64,64,15,13)],[M(e,64,64,14,14),M(e,64,64,15,14)],[M(e,64,64,14,15),M(e,64,64,15,15)]],isTall:!0,message:"It looks warm, but you're not tired yet.",clickEvent:null},19:{name:"candle",tiles:[[M(e,64,64,8,11)]],isTall:!1,message:"Romantic. If only you had something to light it with.",clickEvent:null},20:{name:"barrel",tiles:[[M(e,64,64,11,12)],[M(e,64,64,11,13)]],isTall:!0,message:"You try to pry it open, but it won't budge.",clickEvent:null},21:{name:"stool",tiles:[[M(e,64,64,12,15)]],isTall:!1,message:"You take a seat. You are bored. You stand up.",clickEvent:null},22:{name:"pile of logs",tiles:[[M(e,64,64,8,12)]],isTall:!1,message:" ",clickEvent:function(){let e="";e+=L("There is mold beginning to stretch across the surface of the wood. "),e+=L("Upon closer inspection, you notice that a community of bugs have made this their new home."),t.textPassage.innerHTML+=e}},23:{name:"wooden keg",tiles:[[M(e,64,64,11,15)]],isTall:!1,message:"There is a clear liquid slowly leaking from the front. ",clickEvent:function(){let e;t.textPassage.appendChild(T("What could it be?",function(){w(e="Whatever is in there, surely it's not good after who knows how long it's been sitting there. ",function(){t.textPassage.appendChild(T("Unless?",function(){w(e="Unless it's water. Or wine. Now that you think about it, there are quite a few things it could be that would still be safe to drink. ",function(){t.textPassage.appendChild(T("Try to drink it?",function(){w(e="It looks like water, it feels like water, and it tastes like water with rust in it. It must be water.")}))})}))})}))}},0:{name:"floor",tiles:[[M(e,64,64,14,1)]]},1:{name:"topWall",tiles:[[M(e,64,64,5,1)],[M(e,64,64,5,2)]]},2:{name:"leftWall",tiles:[[M(e,64,64,0,3),M(e,64,64,1,3)]]},3:{name:"rightWall",tiles:[[M(e,64,64,6,3),M(e,64,64,7,3)]]},4:{name:"bottomWall",tiles:[[M(e,64,64,2,7)],[M(e,64,64,2,8)]]},5:{name:"topLeftCorner",tiles:[[M(e,64,64,0,1),M(e,64,64,1,1)],[M(e,64,64,0,2),M(e,64,64,1,2)]]},6:{name:"topRightCorner",tiles:[[M(e,64,64,6,1),M(e,64,64,7,1)],[M(e,64,64,6,2),M(e,64,64,7,2)]]},7:{name:"bottomLeftCorner",tiles:[[M(e,64,64,0,7),M(e,64,64,1,7)],[M(e,64,64,0,8),M(e,64,64,1,8)]]},8:{name:"bottomRightCorner",tiles:[[M(e,64,64,6,7),M(e,64,64,7,7)],[M(e,64,64,6,8),M(e,64,64,7,8)]]},25:{name:"|_Corner",tiles:[[M(e,64,64,2,5),M(e,64,64,3,5)],[M(e,64,64,2,6),M(e,64,64,3,6)]]},26:{name:"_|Corner",tiles:[[M(e,64,64,4,5),M(e,64,64,5,5)],[M(e,64,64,4,6),M(e,64,64,5,6)]]},27:{name:"|--Corner",tiles:[[M(e,64,64,2,3),M(e,64,64,3,3)],[M(e,64,64,2,4),M(e,64,64,3,4)]]},28:{name:"--|Corner",tiles:[[M(e,64,64,4,3),M(e,64,64,5,3)],[M(e,64,64,4,4),M(e,64,64,5,4)]]},11:{name:"topDoor",tiles:[[M(e,64,64,9,6),M(e,64,64,10,6),M(e,64,64,11,6)],[M(e,64,64,9,7),M(e,64,64,10,7),M(e,64,64,11,7)]],clickEvent:x},12:{name:"leftDoor",tiles:[[M(e,64,64,12,6),M(e,64,64,13,6)],[M(e,64,64,12,7),M(e,64,64,13,7)],[M(e,64,64,12,8),M(e,64,64,13,8)]],clickEvent:x},13:{name:"rightDoor",tiles:[[M(e,64,64,14,6),M(e,64,64,15,6)],[M(e,64,64,14,7),M(e,64,64,15,7)],[M(e,64,64,14,8),M(e,64,64,15,8)]],clickEvent:x},14:{name:"bottomDoor",tiles:[[M(e,64,64,9,8),M(e,64,64,10,8),M(e,64,64,11,8)],[M(e,64,64,9,9),M(e,64,64,10,9),M(e,64,64,11,9)]],clickEvent:x}}}();function I(){if(null===E.currentMap)return;let e,n,l,a,o=E.currentMap.height;for(e=Number(t.roomGraphic.style.height.slice(0,-2)),a=0;a<t.allTiles.length;a++)(l=(n=t.allTiles[a].firstElementChild).firstElementChild).src.length>0&&(n.style.height=e/o+"px")}function T(e,t){let n=document.createElement("span");return n.innerHTML=e,n.className="clickable-text fade-in",n.addEventListener("click",function(){c.play(),t()},!1),n}function L(){let e=arguments.length,t=O(e+1),n="";return t<e&&(n=arguments[t]),n}function x(){if(t.tileLayer2.removeEventListener("click",k),t.saveBtn.disabled=!0,c.pause(),g.play(),O(2))w("As you prepare to leave, something leaps out of the shadows! It charges at you!"),t.battleBtn.style.display="block",t.battleBtn.className+=" fade-in",t.battleBtn.addEventListener("click",function e(){H();let n=B.currentRoom,l=n.auras.length,a=n.auras[O(l)],o="You've entered what seems to be a "+n.name+". ";w(o+="The air is... "+a+"."),t.saveBtn.disabled=!1,t.tileLayer2.addEventListener("click",k),t.battleBtn.removeEventListener("click",e),t.battleBtn.className="buttons"},!1);else{H();let e=B.currentRoom,n=e.auras.length,l=e.auras[O(n)],a="You've entered what seems to be a "+e.name+". ";w(a+="The air is... "+l+"."),t.saveBtn.disabled=!1,t.tileLayer2.addEventListener("click",k),t.battleBtn.className="buttons"}}function w(e,n){t.textPassage.className="fade-out",setTimeout(function(){t.textPassage.className="fade-in",t.textPassage.innerHTML=e,n&&n()},t.FADE_TIME)}function k(e){let t=(n=e,(n=n||window.event).target||n.srcElement).parentNode;var n;if("room-object"===t.className){let e=v[t.dataset.objId],n=e.message;c.play(),n?w(n="It's a "+e.name+". "+n,e.clickEvent):e.clickEvent&&e.clickEvent()}}function M(e,t,l,a,o){let i=document.createElement("img"),r=document.createElement("img");return i.addEventListener("load",function e(){let s=document.createElement("canvas"),c=s.getContext("2d");s.width=t,s.height=l,c.drawImage(i,a*t,o*l,t,l,0,0,t,l),r.src=s.toDataURL("image/png"),v.tilesToLoad--,0===v.tilesToLoad&&setTimeout(function e(){null!==n?H(n):setTimeout(e,500)},500),i.removeEventListener("load",e)},!1),i.src=e,r}function H(e=!1){let n,l,a,o,i=t.roomGraphic;t.loadingImage.style.display="inline-block",t.tileLayer2&&(o=i.getElementsByTagName("fragment")[0],i.removeChild(o),t.tileLayer2.removeEventListener("click",k)),e||(E.currentMap=E[O(E.numMaps)],B.currentRoom=B[O(B.numRoomTypes)]),l=E.currentMap,a=B.currentRoom,n=function(e,n){let l,a,o,i,r,s,c,d,m,u;for(o=document.createElement("fragment"),(i=document.createElement("table")).id="tile-layer-1",i.cellSpacing="0",o.appendChild(i),s=document.createElement("tbody"),i.appendChild(s),l=0;l<n;l++)for(c=document.createElement("tr"),s.appendChild(c),a=0;a<e;a++)d=document.createElement("td"),m=document.createElement("div"),u=document.createElement("img"),c.appendChild(d),d.appendChild(m),m.appendChild(u);return(r=i.cloneNode(!0)).id="tile-layer-2",o.appendChild(r),t.allTiles=o.querySelectorAll("td"),t.tileLayer1=i,t.tileLayer2=r,o}(l.width,l.height),function(e,n,l=!1){let a,o,i,r,s,c,d,m,u,h=e.width,g=e.height,y=[],p=[],f=[];for(e=JSON.parse(JSON.stringify(e.array)),u=[],d=[],a=0;a<g;a++)for(d.push([]),u.push([]),o=0;o<h;o++)switch(d[a].push(0),u[a].push(0),e[a][o]){case 1:0===a&&1===e[a][o+2]&&f.push([a,o]);break;case 2:0===o&&2===e[a+2][o]&&f.push([a,o]);break;case 3:o===h-2&&3===e[a+2][o]&&f.push([a,o]);break;case 4:a===g-2&&4===e[a][o+2]&&f.push([a,o]);break;case 0:y.push([a,o]),1===e[a-1][o]&&p.push([a-1,o])}l?u=E.objMap:(!function(e,t,n,l){let a,o,i,r,s,c,d,m,u,h,g=O(e.maxDoors)+1;for(m=l.slice(0),a=0;a<g;a++){do{h=O(m.length),u=l[h],S(m,h),s=t[u[0]][u[1]]+10,r=v[s],c=r.tiles.length,d=r.tiles[0].length}while(F(n,r,u));for(o=0;o<c;o++)for(i=0;i<d;i++)n[u[0]+o][u[1]+i]=s}}(n,e,u,f),function(e,t,n,l,a){let o,i,r,s,c,d,m,u,h,g,y=O(l.length/4),p=e.objTypes.length,f=0;for(o=0;o<e.guaranteedObjects.length;o++){c=e.guaranteedObjects[o],s=v[c],d=s.tiles.length,m=s.tiles[0].length,f+=d*m,u=l.slice(0),s.isTall&&(u=l.concat(a));do{g=O(u.length),h=u[g],S(u,g)}while(F(n,s,h)||void 0===t[h[0]+(d-1)]||0!==t[h[0]+(d-1)][h[1]+(m-1)]||0!==t[h[0]+(d-1)][h[1]]||0!==t[h[0]][h[1]+(m-1)]||0!==t[h[0]][h[1]]);for(i=0;i<d;i++)for(r=0;r<m;r++)n[h[0]+i][h[1]+r]=c}for(;f<=y;){c=e.objTypes[O(p)],s=v[c],d=s.tiles.length,m=s.tiles[0].length,f+=d*m,u=l.slice(0),s.isTall&&(u=l.concat(a));do{g=O(u.length),h=u[g],S(u,g)}while(F(n,s,h)||void 0===t[h[0]+(d-1)]||0!==t[h[0]+(d-1)][h[1]+(m-1)]||0!==t[h[0]+(d-1)][h[1]]||0!==t[h[0]][h[1]+(m-1)]||0!==t[h[0]][h[1]]);for(i=0;i<d;i++)for(r=0;r<m;r++)n[h[0]+i][h[1]+r]=c}}(n,e,u,y,p),E.objMap=u);for(u=JSON.parse(JSON.stringify(u)),a=0;a<g;a++)for(o=0;o<h;o++){if(0===d[a][o]&&void 0!==e[a][o])for(s=v[e[a][o]],i=0;i<s.tiles.length;i++)for(r=0;r<s.tiles[i].length;r++)(m=t.tileLayer1.rows[a+i].cells[o+r].firstElementChild).firstElementChild.src=s.tiles[i][r].src,d[a+i][o+r]=1;else void 0===e[a][o]&&((m=t.tileLayer1.rows[a].cells[o].firstElementChild).firstElementChild.src=v.transparent.src);if(0!==u[a][o]&&-1!==u[a][o])for(c=v[u[a][o]],i=0;i<c.tiles.length;i++)for(r=0;r<c.tiles[i].length;r++)(m=t.tileLayer2.rows[a+i].cells[o+r].firstElementChild).firstElementChild.src=c.tiles[i][r].src,m.className="room-object",m.dataset.objId=u[a+i][o+r],u[a+i][o+r]=-1;else 0===u[a][o]&&((m=t.tileLayer2.rows[a].cells[o].firstElementChild).className="",m.firstElementChild.src=v.transparent.src)}I()}(l,a,e),t.tileLayer2.addEventListener("click",k),I(),t.loadingImage.style.display="none",i.appendChild(n)}function F(e,t,n){let l,a,o=t.tiles.length,i=t.tiles[0].length;for(l=0;l<o;l++)for(a=0;a<i;a++)if(0!==e[n[0]+l][n[1]+a])return!0;return!1}function C(){t.monsterHealthText.innerHTML=Math.round(a.health)+" / "+a.totalHealth,t.monsterBarElement.style.width=100*a.health/a.totalHealth+"%",t.monsterHealthTextFlee.innerHTML=a.health+" / "+a.totalHealth,t.monsterBarElementFlee.style.width=100*a.health/a.totalHealth+"%"}function N(){l.exp>=l.totalExperience&&(l.level++,t.infoBox.innerHTML+="<br> Congratulations! You have reached level "+l.level+"! ",l.totalExperience=5*l.level,l.exp=0),t.characterBarElement.style.width=100*l.health/l.totalHealth+"%",t.characterHealthText.innerHTML=Math.round(l.health)+" / "+l.totalHealth,t.characterBarElementFlee.style.width=100*l.health/l.totalHealth+"%",t.characterHealthTextFlee.innerHTML=Math.round(l.health)+" / "+l.totalHealth,t.characterExperienceText.innerHTML=Math.round(100*l.exp/l.totalExperience)+"%",t.characterExperienceTextFlee.innerHTML=Math.round(100*l.exp/l.totalExperience)+"%",t.characterExperienceBar.style.width=100*l.exp/l.totalExperience+"%",t.characterExperienceBarFlee.style.width=100*l.exp/l.totalExperience+"%"}function D(){m.play(),t.fightWrapper.style.visibility="hidden",t.monsterWeapon.style.opacity=1;var e=280,n=Math.floor(Math.random()*l.totalHealth/5)+1,a=l.health-n,i=280;let r=setInterval(function(){i+=50,t.monsterWeapon.style.right=i+"px",i>=1010&&clearInterval(r)},100);return setTimeout(function(){setTimeout(function(){l.health>0&&(null!==document.getElementById("reset-fight")&&(document.getElementById("reset-fight").id="old"),t.infoBox.innerHTML+="<br> The monster dealt "+n+" damage to you. Select fight or flee from the buttons on the left. ",t.infoBox.innerHTML+='<button class="small-buttons" id="reset-fight"> OK </button> </br>',V(),document.getElementById("reset-fight").addEventListener("click",function(){c.play(),Y(),t.rollDiceBtn.disabled=!1,t.rollDiceBtn.style.opacity="1",P(t.rollDiceBtn),t.fleeBtn.disabled=!1,t.fleeBtn.style.opacity="1",P(t.fleeBtn),document.getElementById("reset-fight").style.visibility="hidden"}))},1500),t.monsterWeapon.style.opacity=0,t.characterFloaty.style.opacity=1,t.characterFloaty.innerHTML="-"+n;let i=setInterval(function(){if(h.play(),t.characterFloaty.style.opacity-=1/30,e+=2.8,t.characterFloaty.style.bottom=e+"px",l.health=l.health-n/30,N(),l.health<=0){setTimeout(function(){document.getElementById("reset-fight").style.visibility="hidden"},5),y.play(),clearInterval(o),clearInterval(i),t.infoBox.innerHTML+="Oh no! The monster dealt "+n+" damage and defeated you. Leaving battle...  ",null!==document.getElementById("fight-to-main-buttons")&&(document.getElementById("fight-to-main-buttons").id="old"),t.infoBox.innerHTML+='<button <button class="small-buttons" id="fight-to-main-buttons"> OK </button> </br>',V(),document.getElementById("fight-to-main-buttons").addEventListener("click",function(){c.play(),t.goToPage("exploration"),l.health=l.totalHealth,document.getElementById("fight-to-main-buttons").style.visibility="hidden"});var r=0;let e=setInterval(function(){r+=25,t.characterAvatar.style.top=r+"px"},100);setTimeout(function(){t.characterWrapper.style.visibility="hidden",clearInterval(e)},1e3)}l.health<=a&&(clearInterval(i),t.characterFloaty.style.opacity=0,l.health=a)},50)},1460),n}function P(e){e.style.webkitAnimation="none",setTimeout(function(){e.style.webkitAnimation=""},10)}function O(e){return Math.floor(Math.random()*Math.floor(e))}function S(e,t){t>=e.length?console.error("ERROR: mutableRemoveIndex: index is out of range"):e.length<=0?console.error("ERROR: mutableRemoveIndex: empty array"):(e[t]=e[e.length-1],e[e.length-1]=void 0,e.length=e.length-1)}function W(e,t){let n,l=[];for(n=0;n<e;n++)l.push(O(t)+1);return l}function R(){let e;t.fightWrapper.style.visibility="visible",t.monsterFloaty.style.opacity=0;let n=t.diceImageList;var a;for(a=5,o=0,t.submitBtn.innerHTML="Go!",t.progressBar.style.width="0%",t.submitBtn.disabled=!1,i.totalTime=a,i.timeRemaining=a,i.countDownIncrement=1/a*100,i.barWidth=0,o=setInterval(function(){t.progressBar.style.width=i.barWidth.toString()+"%",t.submitBtn.innerHTML="Go! 0:"+i.timeRemaining.toString().padStart(2,"0"),i.barWidth+=i.countDownIncrement,i.timeRemaining-=1,-2===i.timeRemaining&&(clearInterval(o),t.submitBtn.disabled=!0,D(),t.infoBox.innerHTML+="<br> Oh no, time's up!</br>",V(),null!==document.getElementById("reset-fight")&&(document.getElementById("reset-fight").id="old"),t.fleeBtn.disabled=!0,t.rollDiceBtn.disabled=!0,t.rollDiceBtn.style.opacity="0.5")},1e3),l.diceValues=W(2,6),t.fleeBtn.disabled=!0,t.fleeBtn.style.opacity="0.5",t.rollDiceBtn.disabled=!0,t.rollDiceBtn.style.opacity="0.5",e=0;e<n.length;e++)n[e].src="assets/dice"+l.diceValues[e]+".png";t.mathQuestion.innerHTML=l.diceValues[0]+" x "+l.diceValues[1]+" = ? Type below.",t.questionContainer.style.visibility="visible"}function Y(){document.getElementById("input-box").value="",document.getElementById("input-box").placehodler="Type your answer here",t.fightWrapper.style.visibility="hidden",t.progressBar.style.width="0%"}function j(){t.questionContainerFlee.style.visibility="hidden",t.rollDiceFleeBtn.disabled=!1,t.rollDiceFleeBtn.style.opacity=1}function G(e,n,i){t.mathResult;let r,s=n[0],d=n[1];switch(i){case"+":r=s+d;break;case"-":r=s-d;break;case"x":r=s*d;break;case"divide":r=s/d}return isNaN(e)?(t.infoBox.innerHTML+="<br> Oops! Please enter a valid number.",V(),!1):e===r?(null!==document.getElementById("monster-attack-button")&&(document.getElementById("monster-attack-button").id="old"),t.infoBox.innerHTML+="<br>"+s+" "+i+" "+d+" = "+r+". You got it right! ",t.submitBtn.disabled=!0,clearInterval(o),t.progressBar.style.width="100%",function(e){u.play(),t.characterWeapon.style.opacity=1;var n=280;t.monsterFloaty.style.opacity=0,t.fightWrapper.style.visibility="hidden";var i=a.health-e,r=0,s=280;let d=setInterval(function(){r+=40,s+=50,t.characterWeapon.style.transform="rotate("+r%360+"deg)",t.characterWeapon.style.left=s+"px",s>=1010&&clearInterval(d)},100);setTimeout(function(){setTimeout(function(){a.health>0&&(null!==document.getElementById("monster-attack-button")&&(document.getElementById("monster-attack-button").id="old"),t.infoBox.innerHTML+="You have dealt "+e+" damage to the monster.  ",t.infoBox.innerHTML+='<button class="small-buttons" id="monster-attack-button"> OK </button> </br>',V(),document.getElementById("monster-attack-button").addEventListener("click",function(){D(),document.getElementById("monster-attack-button").style.visibility="hidden"}))},1300),t.characterWeapon.style.opacity=0,t.monsterFloaty.style.opacity=1,t.monsterFloaty.innerHTML="-"+e;let r=setInterval(function(){if(h.play(),t.monsterFloaty.style.opacity-=1/30,n+=2.8,t.monsterFloaty.style.bottom=n+"px",a.health=a.health-e/30,C(),a.health<=0){setTimeout(function(){let e=document.getElementById("monster-attack-button");e&&(e.style.visibility="hidden")},5),y.play(),clearInterval(o),clearInterval(r),t.infoBox.innerHTML+="<br> Congrats! You beat the monster! You have gained "+2*a.level+" experience points! Leaving battle...";let e=setInterval(function(){h.play(),l.exp=l.exp+2*a.level/30,N()},50);var s=280;t.characterExpFloaty.style.opacity=1,t.characterExpFloaty.innerHTML="+"+2*a.level;let n=setInterval(function(){t.characterExpFloaty.style.opacity-=1/30,s+=2.8,t.characterExpFloaty.style.bottom=s+"px",N(),290===s&&(clearInterval(n),t.characterExpFloaty.style.opacity=0)},50);setTimeout(function(){clearInterval(e),null!==document.getElementById("fight-to-main-buttons")&&(document.getElementById("fight-to-main-buttons").id="old"),t.infoBox.innerHTML+='<button class="small-buttons" id="fight-to-main-buttons"> OK </button> </br>',V(),document.getElementById("fight-to-main-buttons").addEventListener("click",function(){c.play(),t.goToPage("exploration"),document.getElementById("fight-to-main-buttons").style.visibility="hidden"})},1500);var d=0;let i=setInterval(function(){d+=25,t.monsterPicture.style.top=d+"px"},100);setTimeout(function(){t.monsterWrapper.style.visibility="hidden",clearInterval(i)},1e3)}a.health<=i&&(clearInterval(r),a.health=i)},50)},1460)}(r),0===a.health&&t.goToPage("exploration"),!0):(t.infoBox.innerHTML+="<br> You got it wrong. Try again.",V(),!1)}function V(){t.infoBox.scrollTop=t.infoBox.scrollHeight,t.infoBoxFlee.scrollTop=t.infoBoxFlee.scrollHeight}window.addEventListener("load",function(){t.resize(),n=function(){let t,n,a,o;if("undefined"!=typeof Storage){try{t=JSON.parse(localStorage.getItem("GOF_player")),n=JSON.parse(localStorage.getItem("GOF_mapShape")),a=JSON.parse(localStorage.getItem("GOF_objMap")),o=JSON.parse(localStorage.getItem("GOF_gameVersion"))}catch(e){alert("Error: save data missing or corrupted. Creating new save data...")}if(t&&n&&a){if(o&&o===e)return l=t,E.currentMap=n,E.objMap=a,!0;alert("Uh-oh! It looks like your save data is outdated. Creating new save data...")}localStorage.clear()}else alert("Error: saving is unsupported on your system. Please update your web browser and try again.");return!1}(),t.goToPage("start")},!1),window.addEventListener("resize",function(e,t,n){let l;return function(){let a,o=this,i=arguments;a=n&&!l,clearTimeout(l),l=setTimeout(function(){l=null,n||e.apply(o,i)},t),a&&e.apply(o,i)}}(function(){t.resize()},250,!1),!1),t.playBtn.addEventListener("click",function(){c.play(),n?t.goToPage("exploration"):t.goToPage("customize"),t.setBgFade(!0)},!1),t.musicBtn.addEventListener("click",function(){s?(p.pause(),t.musicBtn.innerHTML="Enable Music"):(p.play(),t.musicBtn.innerHTML="Disable Music"),s=!s},!1),t.playCustomizeBtn.addEventListener("click",function(e){var n;c.play(),e.preventDefault(),""===(n=t.userInputName.name.value.trim()).trim()?l.name=t.input.placeholder:l.name=n,t.goToPage("exploration")},!1),t.avatarBtn.addEventListener("click",function(){let e;c.play(),e="assets/character"+(++r%4+1)+".png",t.avatarImage.src=e,l.avatarImg=e},!1),t.exitBtn.addEventListener("click",function(){t.goToPage("start"),c.play()},!1),t.saveBtn.addEventListener("click",function(){n=function(){if("undefined"!=typeof Storage)try{return localStorage.setItem("GOF_player",JSON.stringify(l)),localStorage.setItem("GOF_mapShape",JSON.stringify(E.currentMap)),localStorage.setItem("GOF_objMap",JSON.stringify(E.objMap)),localStorage.setItem("GOF_gameVersion",JSON.stringify(e)),w("Game saved successfully. You may continue exploring."),!0}catch(e){w("Error: there was an issue when trying to save!")}else alert("Error: saving is unsupported on your system. Please update your web browser and try again.");return!1}(),c.play()},!1),t.battleBtn.addEventListener("click",function(){var e,n;c.play(),N(),t.characterWrapper.display="visible",t.monsterFloaty.style.opacity=0,t.characterFloaty.style.opacity=0,e=O(l.level+1)+1,a.name=t.monsterNames[O(t.monsterNames.length)],t.monsterNameLabel.innerHTML='<p class="label-style">'+a.name+"</p>",t.monsterNameLabelFlee.innerHTML='<p class="label-style">'+a.name+"</p>",a.level=e,t.monsterLevelLabel.innerHTML='<p class="label-style"> Level: '+a.level+"</p>",t.monsterLevelLabelFlee.innerHTML='<p class="label-style"> Level: '+a.level+"</p>",a.health=10*e-O(10),a.totalHealth=a.health,t.monsterPicture.src="assets/monster"+(O(10)+1)+".png",t.monsterPictureFlee.src=t.monsterPicture.src,C(),n=l.health/l.totalHealth,l.totalHealth=10*l.level,l.totalExperience=5*l.level,l.health=n*l.totalHealth,t.characterLevelLabel.innerHTML='<p class="label-style"> Level: '+l.level+"</p>",t.characterNameLabel.innerHTML='<p class="label-style">'+l.name+"</p>",t.characterLevelLabelFlee.innerHTML='<p class="label-style"> Level: '+l.level+"</p>",t.characterNameLabelFlee.innerHTML='<p class="label-style">'+l.name+"</p>",t.avatarImgBattle.src=l.avatarImg,N(),t.infoBox.innerHTML+="<br> You encountered "+a.name+"! Would you like to fight it or flee from it?",V(),t.fleeBtn.disabled=!1,t.fleeBtn.style.opacity="1",P(t.fleeBtn),t.rollDiceBtn.disabled=!1,t.rollDiceBtn.style.opacity="1",P(t.rollDiceBtn),t.goToPage("battle"),V(),this.style.display="none"},!1),t.closeModalBtn.addEventListener("click",function(){t.imageModal.style.display="none"},!1),window.addEventListener("click",function(e){e.target===t.imageModal&&(t.imageModal.style.display="none")},!1),t.rollDiceBtn.addEventListener("click",function(){d.play(),R()},!1),t.rollDiceFleeBtn.addEventListener("click",function(){let e,n=t.diceImageListFlee;for(d.play(),t.rollDiceFleeBtn.disabled=!0,t.rollDiceFleeBtn.style.opacity="0.5",l.diceValues=W(2,6),e=0;e<n.length;e++)n[e].src="assets/dice"+l.diceValues[e]+".png";if(t.fleeDiceValue.innerHTML="You rolled a total of "+(l.diceValues[0]+l.diceValues[1])+" !",t.questionContainerFlee.style.visibility="visible",!0==l.diceValues[0]+l.diceValues[1]>=8)t.infoBoxFlee.innerHTML+="<br> Yes, you are ready to flee! You're safe. Leaving battle... ",t.infoBox.innerHTML+="<br> You have successfully fled from "+a.name+".",null!==document.getElementById("flee-to-main-button")&&(document.getElementById("flee-to-main-button").id="old"),t.infoBoxFlee.innerHTML+='<button class="small-buttons" id="flee-to-main-button"> OK </button> </br>',V(),document.getElementById("flee-to-main-button").style.visibility="visible",document.getElementById("flee-to-main-button").addEventListener("click",function(){c.play(),j(),t.goToPage("exploration"),document.getElementById("flee-to-main-button").disabled=!0,document.getElementById("flee-to-main-button").style.visibility="hidden"});else{t.infoBoxFlee.innerHTML+="<br> No, you are not!  You lost "+l.totalHealth/10+" of your health as a result. Returning to battle... ";var o=l.health-l.totalHealth/10;let e=setInterval(function(){h.play(),l.health=l.health-a.totalHealth/300,l.health<=o&&clearInterval(e),N()},50);t.infoBox.innerHTML+="<br> Click the attack button on the left once you are ready to fight the monster! ",null!==document.getElementById("flee-to-fight-button")&&(document.getElementById("flee-to-fight-button").id="old"),t.infoBoxFlee.innerHTML+='<button class="small-buttons" id="flee-to-fight-button"> OK </button> </br>',V(),document.getElementById("flee-to-fight-button").addEventListener("click",function(){c.play(),j(),t.goToPage("battle"),D(),document.getElementById("flee-to-fight-button").disabled=!0,t.fleeBtn.disabled=!0,t.fleeBtn.style.opacity="0.5",t.rollDiceBtn.disabled=!0,t.rollDiceBtn.style.opacity="0.5",t.fleeBtn.style.webkitAnimation="pause",t.rollDiceBtn.style.webkitAnimation="pause",document.getElementById("flee-to-fight-button").style.visibility="hidden",V()})}},!1),t.fleeBtn.addEventListener("click",function(){c.play(),t.goToPage("flee"),t.avatarImgFlee.src=l.avatarImg,t.infoBoxFlee.innerHTML+="<br> Click the Flee button on the left. Roll at least an 8 to see if you are ready to flee! </br>",V()}),t.itemsBtn.addEventListener("click",function(){c.play(),alert("Page under construction...")}),t.userInput.addEventListener("submit",function(e){e.preventDefault(),c.play();let n=t.userInput.answer.value;t.userInput.answer.value="",n=""===n.trim()?NaN:Number(n),isNaN(n)&&!1===G(n,l.diceValues,"x")||G(n,l.diceValues,"x")},!1)}();